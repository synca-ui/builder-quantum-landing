[build]
command = "bash scripts/netlify-build.sh"
functions = "netlify/functions"
publish = "dist/spa"

[build.environment]
NODE_VERSION = "22"
NPM_VERSION = "10"

[functions]
node_bundler = "nft"

# Performance optimizations
[build.processing]
skip_processing = false

[build.processing.css]
bundle = true
minify = true

[build.processing.js]
bundle = true
minify = true

[build.processing.html]
pretty_urls = true

[build.processing.images]
compress = true

# Security headers for all files
[[headers]]
for = "/*"
values = { X-Frame-Options = "DENY", X-XSS-Protection = "1; mode=block", X-Content-Type-Options = "nosniff", Referrer-Policy = "strict-origin-when-cross-origin", Permissions-Policy = "camera=(), microphone=(), geolocation=()" }

# Cache static assets
[[headers]]
for = "/static/*"
values = { Cache-Control = "public, max-age=31536000, immutable" }

# Cache JavaScript files
[[headers]]
for = "/*.js"
values = { Cache-Control = "public, max-age=31536000, immutable" }

# Cache CSS files
[[headers]]
for = "/*.css"
values = { Cache-Control = "public, max-age=31536000, immutable" }

# PWA manifest should not be cached aggressively
[[headers]]
for = "/manifest.json"
values = { Cache-Control = "public, max-age=0, must-revalidate" }

# Service Worker should not be cached aggressively
[[headers]]
for = "/sw.js"
values = { Cache-Control = "public, max-age=0, must-revalidate" }

# API Weiterleitung an Railway
[[redirects]]
from = "/api/*"
to = "https://builder-quantum-landing-production.up.railway.app/api/:splat"
status = 200
force = true

# check.maitr.de → /check-landing (Subdomain-Weiterleitung)
# DNS: check.maitr.de CNAME → dieser Netlify-Site
# Wenn jemand check.maitr.de besucht, wird er direkt zur Check-Seite geleitet
[[redirects]]
from = "https://check.maitr.de/"
to = "/check-landing"
status = 200
force = true

[[redirects]]
from = "https://check.maitr.de/*"
to = "/check-landing"
status = 200
force = true

# Fallback für Single-Page-Application
[[redirects]]
from = "/*"
to = "/index.html"
status = 200